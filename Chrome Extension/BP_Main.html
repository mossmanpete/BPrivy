<!DOCTYPE HTML>
<html>
<head> <title> BPrivy Background Page</title>
<script>
/* JSLint directives */
/*global chrome, window */
/*jslint browser : true, devel : true, es5 : true */
/*properties console.info, console.log, console.warn */
var g = {contextMenuID: null};

function GetCreds(url)
{
	return [{username: "username1", password: "password1"}, {username: "username2", password: "password2"}, {username: "username3", password:"password3"}];
}

function Lookup(info, tab)
{
    var url;
	if (info.menuItemId == g.ContextMenuID)
	{
		console.info("BPMenuItem was clicked on page ");
		if (info.pageUrl) {
			url = info.pageUrl;
		}
		else if (tab.url) {
			url = tab.url;
		}
		console.info("info: " + JSON.stringify(info));
		console.info("tab: " + JSON.stringify(tab));
		var creds = GetCreds(url);
		console.info(creds);
		/*chrome.tabs.executeScript(tab.id, {file: "content_script.js"});*/
	}
}

function ShowOptionsMenu(records)
{
	var i, record, menuProps;
	for (i=0; i < records.length; i+=1)
	{
		record = records[i];
		menuProps = {"type": "normal", "title": record.username, "contexts": ["editable"], "parentId": g.ContextMenuID};
		chrome.contextMenus.create(menuProps);
	}
}

function BPClick(tab)
{
	chrome.tabs.sendRequest(tab.id, {click: true});
}

function main2()
{
	chrome.browserAction.onClicked.addListener(BPClick);
    document.designMode = 'on';// enables saving the document
}


function BPMenuClick(info, tab)
{
	if (info.menuItemId == g.ContextMenuID)
	{
		console.info("BPMenuItem was clicked on page " + info.pageUrl);
		BPClick(tab);
	}
}


function main()
{
	var menuProperties = {"type": "normal", "title": "BPrivy", "contexts": ["all"], "onclick": BPMenuClick, "documentUrlPatterns": document.url};
	var menu_id = chrome.contextMenus.create(menuProperties);
	console.info("Menu Item ID " + menu_id + " Created");

    chrome.browserAction.onClicked.addListener(BPClick);
    document.designMode = 'on';// enables saving the document
	//menuProperties = {"type": "normal", "title": "Privy",  "onclick": MenuClick, "parentId": menu_id};
	//var child_menu = chrome.contextMenus.create(menuProperties);
	//console.info("Child Menu ID " + child_menu + " Created");
	
	return menu_id;
}

g.ContextMenuID = main();

console.info("Menu Item ID = " + g.ContextMenuID);

</script>
</head>
<body>
    <div id='com-bprivy-passworddb' hidden></div>
    <div id="com-bprivy-tagdb" hidden></div>
</body>
</html>
